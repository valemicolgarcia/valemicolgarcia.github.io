---
layout: default
title: Test Stress Detection Model
---

<section class="test-stress-section">
  <div class="test-stress-header">
    <a href="/projects/stress-detection.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Project</a>
    <h1 class="test-stress-title">Test the Stress Detection Model</h1>
    <p class="test-stress-subtitle">Enter a text and discover if the model detects stress</p>
  </div>

  <div class="test-stress-container">
    <div class="test-form-card">
      <h2>Enter your text</h2>
      <form id="stressForm" class="stress-form">
        <textarea 
          id="textInput" 
          class="text-input" 
          placeholder="Write your text in English here...&#10;Example: I am really stressed and anxious"
          rows="6"
          required
        ></textarea>
        <button type="submit" class="predict-btn" id="predictBtn">
          <i class="fas fa-brain"></i> Analyze Text
        </button>
      </form>
    </div>

    <div id="resultCard" class="result-card hidden">
      <div class="result-header">
        <h3>Analysis Result</h3>
        <button class="close-btn" id="closeBtn">&times;</button>
      </div>
      
      <div class="result-content">
        <div class="prediction-badge" id="predictionBadge">
          <span class="badge-label">Prediction:</span>
          <span class="badge-value" id="badgeValue">-</span>
        </div>
        
        <div class="probability-bars">
          <div class="prob-item">
            <div class="prob-label">
              <span>No Stress</span>
              <span class="prob-percent" id="noStressProb">0%</span>
            </div>
            <div class="prob-bar">
              <div class="prob-fill no-stress-fill" id="noStressBar"></div>
            </div>
          </div>
          
          <div class="prob-item">
            <div class="prob-label">
              <span>Stress</span>
              <span class="prob-percent" id="stressProb">0%</span>
            </div>
            <div class="prob-bar">
              <div class="prob-fill stress-fill" id="stressBar"></div>
            </div>
          </div>
        </div>
        
        <div class="result-text">
          <p><strong>Analyzed text:</strong></p>
          <p class="analyzed-text" id="analyzedText"></p>
        </div>
      </div>
    </div>

    <div id="loadingCard" class="loading-card hidden">
      <div class="loading-spinner"></div>
      <p>Analyzing text...</p>
    </div>

    <div id="errorCard" class="error-card hidden">
      <div class="error-icon">⚠️</div>
      <h3>Error</h3>
      <p id="errorMessage"></p>
      <button class="retry-btn" onclick="document.getElementById('errorCard').classList.add('hidden')">Close</button>
    </div>

    <div class="examples-section">
      <h3>Examples to try</h3>
      <div class="examples-grid">
        <button class="example-btn" onclick="setExample('I am really stressed and anxious')">
          "I am really stressed and anxious"
        </button>
        <button class="example-btn" onclick="setExample('I am relaxed')">
          "I am relaxed"
        </button>
        <button class="example-btn" onclick="setExample('I feel overwhelmed and cannot stop worrying')">
          "I feel overwhelmed and cannot stop worrying"
        </button>
        <button class="example-btn" onclick="setExample('I had a great day today')">
          "I had a great day today"
        </button>
      </div>
    </div>
  </div>
</section>

<script>
// ============================================
// CONFIGURATION - COMPLETE WITH YOUR DATA
// ============================================
// Hugging Face Space URL (replace with your Space URL)
// Format: https://YOUR_USERNAME-YOUR_SPACE.hf.space/predict
// Example: https://valemicolgarcia-stress-detection-api.hf.space/predict
const HF_SPACE_API_URL = 'https://valemicolgarcia-stress-detection-api.hf.space/predict';  // ⚠️ REPLACE with your Space URL

// ============================================
// API CONFIGURATION
// ============================================
// Automatically detects if on localhost or production
const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
const LOCAL_API_URL = 'http://localhost:5000/predict';  // Local Flask API

// ============================================
// HELPER FUNCTIONS
// ============================================
function setExample(text) {
  document.getElementById('textInput').value = text;
}

// ============================================
// MAIN FUNCTION: ANALYZE STRESS
// ============================================
async function analizarEstres(text) {
  if (isLocalhost) {
    // Local mode: use local Flask API
    return await analizarEstresLocal(text);
  } else {
    // Production mode: use Hugging Face Space API
    return await analizarEstresHuggingFaceSpace(text);
  }
}

// Function for local analysis (Flask API)
async function analizarEstresLocal(text) {
  const response = await fetch(LOCAL_API_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ text: text })
  });
  
  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new Error(errorData.error || `Error ${response.status}: ${response.statusText}`);
  }
  
  return await response.json();
}

// Function for analysis with Hugging Face Space API
async function analizarEstresHuggingFaceSpace(text) {
  const response = await fetch(HF_SPACE_API_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ text: text })
  });
  
  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new Error(errorData.error || `Error ${response.status}: ${response.statusText}`);
  }
  
  return await response.json();
}

// ============================================
// FORM HANDLING
// ============================================
async function predictStress(event) {
  event.preventDefault();
  
  const text = document.getElementById('textInput').value.trim();
  
  if (!text) {
    alert('Please enter a text');
    return;
  }
  
  // Show loading
  document.getElementById('loadingCard').classList.remove('hidden');
  document.getElementById('resultCard').classList.add('hidden');
  document.getElementById('errorCard').classList.add('hidden');
  document.getElementById('predictBtn').disabled = true;
  
  try {
    // 60 second timeout (HF may take time if model is loading)
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 60000);
    
    const data = await analizarEstres(text);
    
    clearTimeout(timeoutId);
    
    // Show result
    displayResult(data);
    
  } catch (error) {
    console.error('Error:', error);
    let errorMessage = 'Could not analyze the text. ';
    
    if (error.name === 'AbortError') {
      errorMessage += 'The request took too long to respond. Please try again.';
    } else if (error.message) {
      errorMessage += error.message;
    } else {
      errorMessage += 'Make sure the configuration is correct.';
    }
    
    showError(errorMessage);
  } finally {
    document.getElementById('loadingCard').classList.add('hidden');
    document.getElementById('predictBtn').disabled = false;
  }
}

// ============================================
// DISPLAY RESULTS
// ============================================
function displayResult(data) {
  const resultCard = document.getElementById('resultCard');
  const badgeValue = document.getElementById('badgeValue');
  const noStressProb = document.getElementById('noStressProb');
  const stressProb = document.getElementById('stressProb');
  const noStressBar = document.getElementById('noStressBar');
  const stressBar = document.getElementById('stressBar');
  const analyzedText = document.getElementById('analyzedText');
  
  // Update badge (translate label to English)
  const labelTranslations = {
    'Estrés': 'Stress',
    'No Estrés': 'No Stress',
    'Stress': 'Stress',
    'No Stress': 'No Stress'
  };
  badgeValue.textContent = labelTranslations[data.label] || data.label;
  badgeValue.className = 'badge-value ' + (data.prediction === 1 ? 'stress' : 'no-stress');
  
  // Update probabilities
  const noStressPercent = (data.probability.no_stress * 100).toFixed(1);
  const stressPercent = (data.probability.stress * 100).toFixed(1);
  
  noStressProb.textContent = noStressPercent + '%';
  stressProb.textContent = stressPercent + '%';
  
  noStressBar.style.width = noStressPercent + '%';
  stressBar.style.width = stressPercent + '%';
  
  // Update analyzed text
  analyzedText.textContent = data.text;
  
  // Show result
  resultCard.classList.remove('hidden');
  resultCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// ============================================
// ERROR HANDLING
// ============================================
function showError(message) {
  const errorCard = document.getElementById('errorCard');
  const errorMessage = document.getElementById('errorMessage');
  errorMessage.textContent = message;
  errorCard.classList.remove('hidden');
  errorCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// ============================================
// EVENT LISTENERS
// ============================================
document.getElementById('stressForm').addEventListener('submit', predictStress);

document.getElementById('closeBtn').addEventListener('click', function() {
  document.getElementById('resultCard').classList.add('hidden');
});
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
